# GiveFlow 全功能测试指南

## 🎯 概述

这个完善的测试页面支持所有 4 个已部署的智能合约：

| 合约 | 地址 | 功能 |
|------|------|------|
| **CampaignRegistry** | `0xe50e3B162a3671fc758FcD53766C95582DF63ebF` | 项目注册与捐赠管理 |
| **ProofRegistry** | `0x47CE6C2Aa4BCd4F0b8991337DD14bd3C4b5d68c5` | 凭证存证与 AI 审核 |
| **MilestoneVault** | `0x25c7f99292a87C31d94bd741770d33A8d87a7c87` | 里程碑资金管理 |
| **BatchDonate** | `0xBAB71010e46DDf7B9E183d2C57753842d3cC5118` | 批量捐赠（并行执行） |

---

## 🚀 快速开始

### 1. 启动开发服务器

```bash
cd app
npm run dev
```

服务器将在 `http://localhost:3000` 启动

### 2. 访问测试页面

在浏览器中打开：
```
http://localhost:3000/test-contracts
```

### 3. 连接钱包

1. 确保钱包已切换到 **Monad Testnet** (Chain ID: 10143)
2. 点击页面上的连接钱包按钮
3. 确认连接

---

## 📋 完整测试流程

### 测试 1: CampaignRegistry - 项目管理

#### 步骤 1.1: 创建项目
1. 在 Tab 导航中选择 "📋 项目管理"
2. 填写项目信息：
   - **标题**: 测试项目 - 医疗救助
   - **描述**: 这是一个测试项目
   - **类别**: medical
   - **目标金额**: 1 MON
3. 点击 "📝 创建项目"
4. 在钱包中确认交易
5. 等待约 15 秒，查看操作日志

**预期结果**:
- ✅ 显示 "项目创建成功！"
- ✅ 项目总数增加

#### 步骤 1.2: 查询项目详情
1. 输入项目 ID（例如：1）
2. 点击 "查询项目"
3. 查看右侧的项目详情面板

**预期结果**:
- ✅ 显示项目的完整信息
- ✅ 标题、目标金额、受益人等信息正确

#### 步骤 1.3: 向项目捐赠
1. 输入捐赠金额（例如：0.001 MON）
2. 点击 "💰 捐赠"
3. 在钱包中确认交易
4. 等待确认

**预期结果**:
- ✅ 显示 "捐赠成功！"
- ✅ 项目的已筹金额增加
- ✅ 捐赠人数增加

---

### 测试 2: MilestoneVault - 里程碑管理

#### 步骤 2.1: 创建里程碑
1. 在 Tab 导航中选择 "🎯 里程碑"
2. 填写里程碑信息：
   - **项目 ID**: 1
   - **标题**: 第一阶段 - 采购医疗设备
   - **目标金额**: 0.5 MON
   - **需要凭证验证**: ✅ 勾选
3. 点击 "🎯 创建里程碑"
4. 确认交易

**预期结果**:
- ✅ 显示 "里程碑创建成功！"
- ✅ 里程碑总数增加

#### 步骤 2.2: 查询里程碑
1. 输入里程碑 ID（例如：1）
2. 点击 "查询凭证"
3. 查看右侧的里程碑详情

**预期结果**:
- ✅ 显示里程碑的完整信息
- ✅ 目标金额、状态等信息正确

---

### 测试 3: ProofRegistry - 凭证管理

#### 步骤 3.1: 提交凭证
1. 在 Tab 导航中选择 "🔍 凭证管理"
2. 填写凭证信息：
   - **项目 ID**: 1
   - **里程碑 ID**: 1
   - **申请金额**: 0.1 MON
   - **IPFS URI**: `ipfs://QmTest123`
3. 点击 "📤 提交凭证"
4. 确认交易

**预期结果**:
- ✅ 显示 "凭证提交成功！"
- ✅ 凭证总数增加

#### 步骤 3.2: 查询凭证
1. 输入凭证 ID（例如：1）
2. 点击 "查询凭证"
3. 查看右侧的凭证详情

**预期结果**:
- ✅ 显示凭证的完整信息
- ✅ 状态为 "待审核"
- ✅ IPFS URI 正确显示

---

### 测试 4: BatchDonate - 批量捐赠

#### 步骤 4.1: 批量捐赠
1. 在 Tab 导航中选择 "⚡ 批量捐赠"
2. 输入每个项目的捐赠金额（例如：0.001 MON）
3. 点击 "⚡ 批量捐赠"
4. 确认交易

**预期结果**:
- ✅ 显示 "批量捐赠成功！"
- ✅ 同时向多个项目捐赠
- ✅ 查看您的捐赠统计，总金额增加

**Monad 并行执行优势**:
- ⚡ 一次交易完成多笔捐赠
- 💰 Gas 费用更低
- 🚀 执行速度更快

---

## 📊 查看测试结果

### 右侧面板显示内容

#### 1. 项目详情
- 项目 ID、标题、受益人
- 目标金额、已筹金额
- 捐赠人数、状态

#### 2. 凭证详情
- 凭证 ID、项目 ID、里程碑 ID
- 提交者、申请金额
- 审核状态、置信度
- IPFS 链接

#### 3. 里程碑详情
- 里程碑 ID、项目 ID
- 标题、目标金额
- 已释放金额、状态
- 是否需要凭证

#### 4. 项目余额
- 项目在 MilestoneVault 中的余额
- 可用于里程碑提款的资金

#### 5. 您的捐赠统计
- 总捐赠金额
- 捐赠历史记录（按项目分组）

#### 6. 操作日志
- 所有操作的实时日志
- 成功和错误信息
- 交易哈希

---

## 🔧 高级测试场景

### 场景 1: 完整的捐赠 → 里程碑 → 提款流程

1. **创建项目** → 查看项目详情
2. **向项目捐赠** 0.5 MON → 查看已筹金额
3. **创建里程碑** → 目标 0.3 MON，需要凭证
4. **提交凭证** → 申请 0.1 MON
5. **（模拟）AI 审核** → 需要通过脚本或 Explorer 手动调用 `recordAIReview`
6. **凭证提款** → 使用 MilestoneVault 的 `withdrawWithProof`

### 场景 2: 批量捐赠并行执行

1. 确保有至少 2 个项目（ID 1 和 2）
2. 切换到 "⚡ 批量捐赠" Tab
3. 设置捐赠金额为 0.001 MON
4. 执行批量捐赠
5. 在操作日志中观察交易哈希
6. 在 Monad Explorer 查看交易详情

### 场景 3: 里程碑状态变更

1. 创建一个里程碑
2. 查看初始状态（待开始）
3. 提交凭证并完成部分提款
4. 再次查看里程碑状态（应变为"进行中"）
5. 完成全部目标金额后查看状态（应变为"已完成"）

---

## 🐛 常见问题排查

### 问题 1: 交易失败 "insufficient funds"

**原因**: 钱包余额不足

**解决方法**:
1. 访问 [Monad Faucet](https://faucet.monad.xyz)
2. 获取测试币
3. 等待币到账后重试

### 问题 2: 交易失败 "execution reverted"

**原因**: 合约逻辑错误或参数不正确

**解决方法**:
1. 检查项目 ID 是否存在
2. 检查里程碑 ID 是否存在
3. 检查凭证 ID 是否存在
4. 查看操作日志中的详细错误信息

### 问题 3: 无法连接钱包

**原因**: 钱包未安装或网络错误

**解决方法**:
1. 确保安装了 MetaMask 或其他钱包
2. 刷新页面
3. 检查钱包是否已解锁
4. 确保切换到 Monad Testnet

### 问题 4: 提款失败 "Proof not approved"

**原因**: 凭证未通过审核

**解决方法**:
1. 查询凭证状态
2. 确保证状状态为 "AI 审核通过" 或 "人工审核通过"
3. 如果状态为 "待审核"，需要先进行 AI 审核（需要授权的审核员地址）

### 问题 5: 批量捐赠后余额不对

**原因**: 某些项目可能不存在或已结束

**解决方法**:
1. 确认所有项目 ID 都存在
2. 检查项目状态是否为活跃
3. 查看 BatchDonate 合约事件日志

---

## 📈 性能测试

### Gas 费用对比

在 Monad Testnet 上的预期 Gas 费用：

| 操作 | 预期 Gas 费 | 说明 |
|------|------------|------|
| 创建项目 | < 0.01 MON | 包含所有字段 |
| 单次捐赠 | < 0.005 MON | 基础捐赠 |
| 批量捐赠 (2个项目) | < 0.01 MON | 并行执行优势 |
| 创建里程碑 | < 0.01 MON | 基础创建 |
| 提交凭证 | < 0.01 MON | 包含 IPFS 哈希 |
| 凭证提款 | < 0.015 MON | 包含验证逻辑 |

### 并行执行优势测试

对比测试：
1. **单次方式**: 向 5 个项目分别捐赠
2. **批量方式**: 使用 BatchDonate 一次交易

**预期结果**:
- 批量方式节省约 40-60% 的 Gas 费
- 交易确认时间相同（约 15 秒）
- 用户体验更流畅

---

## 🔍 在 Explorer 查看详情

### 查看合约

1. 访问 [Monad Testnet Explorer](https://testnet.monadexplorer.com)
2. 输入合约地址搜索
3. 查看合约的：
   - 交易历史
   - 事件日志
   - 合约状态
   - 代码（如果已验证）

### 查看交易

1. 从操作日志中复制交易哈希
2. 在 Explorer 中搜索该哈希
3. 查看：
   - 交易状态
   - Gas 使用情况
   - 事件日志
   - 输入数据

---

## 📝 测试检查清单

使用此清单确保所有功能都已测试：

### CampaignRegistry
- [ ] 创建项目成功
- [ ] 查询项目详情正确
- [ ] 项目总数统计正确
- [ ] 单次捐赠成功
- [ ] 已筹金额更新正确
- [ ] 捐赠人数统计正确
- [ ] 项目状态显示正确

### ProofRegistry
- [ ] 提交凭证成功
- [ ] 凭证哈希计算正确
- [ ] 查询凭证详情正确
- [ ] 凭证总数统计正确
- [ ] 状态显示正确（待审核）
- [ ] IPFS URI 存储正确

### MilestoneVault
- [ ] 创建里程碑成功
- [ ] 里程碑详情查询正确
- [ ] 里程碑总数统计正确
- [ ] 目标金额存储正确
- [ ] 状态显示正确（待开始）
- [ ] 是否需要凭证标记正确

### BatchDonate
- [ ] 批量捐赠成功
- [ ] 同时向多个项目捐赠
- [ ] 总金额计算正确
- [ ] 捐赠历史记录正确
- [ ] 总捐赠金额统计正确
- [ ] 并行执行优势明显

---

## 💡 提示和技巧

1. **保存常用数据**: 将创建的项目 ID、里程碑 ID、凭证 ID 记录下来，方便后续测试
2. **使用小金额**: 测试时使用 0.001 MON 等小金额，节省测试币
3. **查看实时日志**: 操作日志会显示所有操作的详细信息，包括错误
4. **使用 Explorer**: 在 Explorer 中可以验证链上数据是否正确
5. **测试错误情况**: 尝试输入不存在的 ID，查看错误处理是否正确

---

## 🎓 下一步

完成基础测试后，你可以：

1. **集成 AI 审核**: 实现真实的 AI 审核功能
2. **IPFS 集成**: 实际上传文件到 IPFS
3. **前端优化**: 改进 UI/UX 设计
4. **添加更多功能**: 如项目投票、评论等
5. **部署到主网**: 在 Monad 主网部署

---

## 📞 需要帮助？

如果遇到问题：
1. 查看操作日志中的错误信息
2. 在 Monad Explorer 查看交易详情
3. 检查钱包网络配置
4. 确认合约地址正确

祝测试顺利！🎉
