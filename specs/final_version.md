# GiveFlow 项目规划 V3（x402 企业付费 + 个人免费）

> 整合双视角追踪、AI 凭证审核、x402 协议企业收费模式

---

## 一、项目概述

### 1.1 一句话 Pitch

**GiveFlow** 是基于 Monad 的可验证慈善资金网络，个人用户免费使用，企业通过 **x402 协议**按需付费获取高级服务，让每一分钱都透明可查、AI 可验证。

### 1.2 核心价值主张

| 价值点 | 说明 |
|--------|------|
| **零抽成直达** | 个人捐款 100% 到达受益人，平台不收取任何中间费用 |
| **双视角透明** | 捐赠者追踪资金去向 + 受益人凭证审核提款 |
| **AI 凭证审核** | 受益人提款需上传凭证，AI 自动识别鉴定后释放资金 |
| **x402 企业付费** | 企业用户通过 x402 协议按需付费，获取高级报告与服务 |
| **并行微捐** | Monad 低 Gas + 并行执行，支持 $0.01 起捐 |

### 1.3 双视角设计（核心创新）

```
┌─────────────────────────────────────────────────────────────────┐
│                      捐赠者视角 (Donor View)                     │
├─────────────────────────────────────────────────────────────────┤
│  "我的钱去哪了？"                                                │
│                                                                  │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐  │
│  │ 我的捐赠 │ → │ 项目资金池│ → │ 里程碑释放│ → │ 使用凭证 │  │
│  │  $10     │    │  $1,000  │    │  阶段1   │    │ 医疗收据 │  │
│  └──────────┘    └──────────┘    └──────────┘    └──────────┘  │
│                                                                  │
│  ✓ 实时追踪每一笔捐赠的流向                                      │
│  ✓ 查看资金被用于什么用途（凭证可见）                            │
│  ✓ AI 解释资金去向："您的 $10 已用于购买 XX 药品"                │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                   受益人/发起人视角 (Beneficiary View)           │
├─────────────────────────────────────────────────────────────────┤
│  "如何提取资金？"                                                │
│                                                                  │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐  │
│  │ 筹款进度 │ → │ 上传凭证 │ → │ AI 审核  │ → │ 资金释放 │  │
│  │  80%     │    │ 发票/收据│    │ 自动鉴定 │    │ 到账通知 │  │
│  └──────────┘    └──────────┘    └──────────┘    └──────────┘  │
│                                                                  │
│  ✓ 查看项目筹款进度与捐赠明细                                    │
│  ✓ 上传支出凭证申请提款                                          │
│  ✓ AI 自动识别凭证真实性 → 通过后链上释放资金                    │
└─────────────────────────────────────────────────────────────────┘
```

---

## 二、x402 企业付费模式

### 2.1 什么是 x402 协议

x402 是基于 HTTP 402 状态码的支付协议，允许 API 服务按需收费：

```
┌─────────────────────────────────────────────────────────────────┐
│                      x402 支付流程                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. 企业请求高级 API（如月度报告）                               │
│                    ↓                                             │
│  2. 服务端返回 HTTP 402 + 支付要求                               │
│     {                                                            │
│       "price": "10 USDC",                                        │
│       "network": "monad",                                        │
│       "recipient": "0x..."                                       │
│     }                                                            │
│                    ↓                                             │
│  3. 企业客户端完成链上支付                                       │
│                    ↓                                             │
│  4. 服务端验证支付 → 返回数据                                    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 收费模式对比

| 用户类型 | 基础功能 | 收费 | 额外权益 |
|----------|----------|------|----------|
| **个人捐赠者** | 捐赠、追踪、查看凭证、基础报告 | **免费** | — |
| **个人发起人** | 发起项目、上传凭证、提款 | **免费** | — |
| **企业捐赠者** | 所有个人功能 | **x402 按需付费** | 品牌展示、税务凭证、批量操作 |
| **企业发起人** | 所有个人功能 | **x402 按需付费** | 高级报告、优先审核、API 接入 |

### 2.3 x402 收费项目

| 服务 | 收费方式 | 价格示例 |
|------|----------|----------|
| **月度捐赠报告** | 按次 | 5 USDC / 次 |
| **年度影响力报告** | 按次 | 20 USDC / 次 |
| **税务凭证生成** | 按次 | 10 USDC / 份 |
| **批量捐赠 API** | 按调用量 | 0.1 USDC / 次 |
| **优先 AI 审核通道** | 按次 | 2 USDC / 次 |
| **品牌定制页面** | 订阅 | 50 USDC / 月 |
| **CSR 报告导出** | 按次 | 30 USDC / 次 |
| **高级数据分析 API** | 按调用量 | 0.5 USDC / 次 |

### 2.4 为什么选择 x402

| 优势 | 说明 |
|------|------|
| **无订阅负担** | 企业按需付费，不用预付订阅费 |
| **链上透明** | 所有付费记录链上可查 |
| **即时结算** | 支付完成即刻获取服务 |
| **Monad 低成本** | 利用 Monad 低 Gas 实现微支付 |
| **可编程** | 智能合约自动处理收费逻辑 |

### 2.5 企业使用场景详解

#### 场景一：企业 CSR 报告生成

**背景**：某科技公司 TechCorp 每季度需要向董事会提交 CSR（企业社会责任）报告。

```
┌─────────────────────────────────────────────────────────────────┐
│                    TechCorp 获取 CSR 报告                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. TechCorp 财务人员登录企业 Dashboard                          │
│     → 点击 "生成 Q4 CSR 报告"                                    │
│                                                                  │
│  2. 系统检测到这是付费服务                                       │
│     → 前端调用 GET /api/reports/csr?quarter=Q4                   │
│     → 后端返回 HTTP 402:                                         │
│        {                                                         │
│          "status": 402,                                          │
│          "service": "csr_report_q4",                             │
│          "price": "30 USDC",                                     │
│          "payTo": "0x1234...5678",                               │
│          "network": "monad"                                      │
│        }                                                         │
│                                                                  │
│  3. 前端弹出支付确认框                                           │
│     "生成 CSR 报告需支付 30 USDC，是否确认？"                    │
│     → 用户点击 "确认支付"                                        │
│     → 钱包弹出签名请求                                           │
│                                                                  │
│  4. 链上支付完成                                                 │
│     → x402PaymentHub 合约记录支付                                │
│     → 返回 paymentId: "0xabc...def"                              │
│                                                                  │
│  5. 前端携带 paymentId 重新请求                                  │
│     → GET /api/reports/csr?quarter=Q4                            │
│     → Header: X-Payment-Id: 0xabc...def                          │
│                                                                  │
│  6. 后端验证支付 → 生成报告 → 返回 PDF                           │
│                                                                  │
│  ✅ TechCorp 获得精美的 CSR 报告，包含：                         │
│     - 本季度总捐赠额：$50,000                                    │
│     - 支持项目数：12 个                                          │
│     - 受益人数：1,200+                                           │
│     - 资金使用凭证汇总                                           │
│     - 影响力可视化图表                                           │
└─────────────────────────────────────────────────────────────────┘
```

#### 场景二：批量捐赠 API 调用

**背景**：某基金会 GoodFoundation 每月向 50 个合作项目自动分发捐款。

```
┌─────────────────────────────────────────────────────────────────┐
│                   GoodFoundation 批量捐赠                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. 基金会后台系统调用 API                                       │
│     POST /api/enterprise/batch-donate                            │
│     Body: {                                                      │
│       "donations": [                                             │
│         { "campaignId": 1, "amount": 1000 },                     │
│         { "campaignId": 2, "amount": 500 },                      │
│         ... (共 50 个项目)                                       │
│       ]                                                          │
│     }                                                            │
│                                                                  │
│  2. 首次调用返回 HTTP 402                                        │
│     {                                                            │
│       "service": "batch_donate_api",                             │
│       "calls": 50,                                               │
│       "pricePerCall": "0.1 USDC",                                │
│       "totalPrice": "5 USDC"                                     │
│     }                                                            │
│                                                                  │
│  3. 基金会系统自动完成支付（预授权模式）                         │
│     → 从企业钱包扣除 5 USDC                                      │
│     → 获取 paymentId                                             │
│                                                                  │
│  4. 携带 paymentId 重新调用                                      │
│     → 后端验证支付 → 执行 50 笔批量捐赠                          │
│     → 返回所有交易哈希                                           │
│                                                                  │
│  ✅ 50 笔捐赠一次完成，API 费用仅 5 USDC                         │
└─────────────────────────────────────────────────────────────────┘
```

#### 场景三：企业税务凭证生成

**背景**：企业年终报税，需要获取全年捐赠的税务抵扣凭证。

```
┌─────────────────────────────────────────────────────────────────┐
│                    企业税务凭证生成                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  财务人员：                                                      │
│  "我需要 2025 年全年的捐赠税务凭证"                              │
│                                                                  │
│  ┌──────────────┐                                                │
│  │ 企业Dashboard │                                               │
│  │              │                                                │
│  │ [税务凭证]   │  ← 点击                                        │
│  │ 选择年份:2025│                                                │
│  │ [生成凭证]   │  ← 点击                                        │
│  └──────────────┘                                                │
│         │                                                        │
│         ▼                                                        │
│  ┌──────────────────────────────────────┐                        │
│  │         支付确认弹窗                  │                        │
│  │                                      │                        │
│  │  服务：年度税务凭证生成              │                        │
│  │  价格：10 USDC                       │                        │
│  │                                      │                        │
│  │  [取消]          [确认支付]          │                        │
│  └──────────────────────────────────────┘                        │
│         │                                                        │
│         ▼ (支付完成)                                             │
│  ┌──────────────────────────────────────┐                        │
│  │         税务凭证 PDF                  │                        │
│  │                                      │                        │
│  │  企业名称：TechCorp Inc.             │                        │
│  │  税号：12-3456789                    │                        │
│  │  2025年度捐赠总额：$120,000          │                        │
│  │  可抵扣金额：$120,000                │                        │
│  │  项目明细：[附表]                    │                        │
│  │  链上验证：0x...（可点击验证）       │                        │
│  │                                      │                        │
│  │  [下载 PDF]    [发送至邮箱]          │                        │
│  └──────────────────────────────────────┘                        │
│                                                                  │
│  ✅ 税务凭证包含链上哈希，可被税务机关验证真实性                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 场景四：优先 AI 审核通道

**背景**：某企业发起的大额项目需要紧急提款，希望 AI 审核更快。

```
┌─────────────────────────────────────────────────────────────────┐
│                    优先 AI 审核通道                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  普通审核：排队等待 → 预计 2-4 小时                              │
│  优先审核：付费加速 → 预计 5-10 分钟                             │
│                                                                  │
│  企业项目负责人：                                                │
│  "我们的灾区救援项目急需提款，能否加速审核？"                    │
│                                                                  │
│  上传凭证后弹出选项：                                            │
│  ┌──────────────────────────────────────┐                        │
│  │         选择审核通道                  │                        │
│  │                                      │                        │
│  │  ○ 普通审核（免费）                  │                        │
│  │    预计等待：2-4 小时                │                        │
│  │                                      │                        │
│  │  ● 优先审核（2 USDC）               │  ← 选择                 │
│  │    预计等待：5-10 分钟               │                        │
│  │                                      │                        │
│  │  [确认]                              │                        │
│  └──────────────────────────────────────┘                        │
│         │                                                        │
│         ▼                                                        │
│  支付 2 USDC → 凭证进入优先队列 → 8 分钟后审核完成               │
│         │                                                        │
│         ▼                                                        │
│  ✅ 审核通过 → 资金立即释放 → 灾区救援物资采购                   │
└─────────────────────────────────────────────────────────────────┘
```

#### x402 对比传统订阅

| 传统订阅制 | x402 按需付费 |
|------------|---------------|
| 预付 $500/月，用不完也付 | 用多少付多少 |
| 锁定期限，难以退出 | 随用随付，无锁定 |
| 账单周期结算 | 即时链上结算 |
| 需要信用卡/合同 | 钱包直接支付 |
| 费用不透明 | 链上可查，完全透明 |

**企业受益总结**：
- 💰 **成本可控**：小企业一年可能只需要几十 USDC
- 🔍 **完全透明**：每一笔服务费都在链上可查
- ⚡ **即时获取**：支付完成立即获得服务
- 📊 **按需扩展**：业务增长时自然增加用量

---

## 三、系统架构

### 3.1 架构总览

```
┌─────────────────────────────────────────────────────────────────┐
│                         用户层                                   │
│     个人捐赠者 / 企业捐赠者 / 项目发起人 / 受益人                │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                        前端层                                    │
│   Next.js 15 + shadcn/ui + TailwindCSS + Wallet Connect         │
│                                                                  │
│   ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐          │
│   │ 捐赠者   │ │ 发起人   │ │ 企业     │ │ AI Chat  │          │
│   │ Dashboard│ │ Dashboard│ │ Dashboard│ │          │          │
│   └──────────┘ └──────────┘ └──────────┘ └──────────┘          │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                        API 层                                    │
│                                                                  │
│   ┌─────────────────┐  ┌─────────────────┐                      │
│   │   免费 API      │  │  x402 付费 API   │                      │
│   │ /api/donate     │  │ /api/reports    │ ← HTTP 402           │
│   │ /api/track      │  │ /api/export     │                      │
│   │ /api/upload     │  │ /api/analytics  │                      │
│   └─────────────────┘  └─────────────────┘                      │
│                                                                  │
│   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐               │
│   │   AI 层    │ │  Web3 层   │ │  数据层     │               │
│   │ 凭证审核   │ │ wagmi/viem │ │  Supabase   │               │
│   │ OCR + GPT  │ │ x402 SDK   │ │             │               │
│   └─────────────┘ └─────────────┘ └─────────────┘               │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                     Monad 区块链                                 │
│                                                                  │
│   ┌────────────────┐  ┌────────────────┐  ┌────────────────┐   │
│   │CampaignRegistry│  │ MilestoneVault │  │  BatchDonate   │   │
│   │ 项目注册管理   │  │ 凭证审核释放   │  │  批量捐赠      │   │
│   └────────────────┘  └────────────────┘  └────────────────┘   │
│                                                                  │
│   ┌────────────────┐  ┌────────────────┐                        │
│   │ x402PaymentHub │  │ ProofRegistry  │                        │
│   │ 企业付费结算   │  │ 凭证哈希存证   │                        │
│   └────────────────┘  └────────────────┘                        │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 技术栈

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| **前端** | Next.js 15 + App Router | SSR + 现代 React |
| **UI** | shadcn/ui + TailwindCSS | 美观且可定制 |
| **钱包** | wagmi v2 + viem | Web3 交互 |
| **x402** | x402-axios / 自定义中间件 | 企业付费处理 |
| **AI** | Vercel AI SDK + OpenAI GPT-4V | 凭证 OCR + 审核 |
| **数据库** | Supabase (PostgreSQL) | 元数据存储 |
| **合约** | Solidity + Foundry | Monad Testnet |
| **存储** | IPFS / Arweave | 凭证文件存储 |

---

## 四、智能合约设计

### 4.1 合约结构（含 x402）

#### x402PaymentHub.sol（新增）
```solidity
// x402 企业付费处理合约
contract x402PaymentHub {
    // 服务定价
    mapping(bytes32 => uint256) public servicePrices;
    
    // 支付记录
    struct Payment {
        address payer;
        bytes32 serviceId;
        uint256 amount;
        uint256 timestamp;
        bytes32 requestHash;
    }
    
    mapping(bytes32 => Payment) public payments;
    
    // 企业支付服务费
    function payForService(
        bytes32 serviceId,
        bytes32 requestHash
    ) external payable returns (bytes32 paymentId);
    
    // 验证支付（供后端调用）
    function verifyPayment(
        bytes32 paymentId,
        address payer
    ) external view returns (bool valid, uint256 amount);
    
    // 事件
    event ServicePaid(
        bytes32 indexed paymentId,
        address indexed payer,
        bytes32 serviceId,
        uint256 amount
    );
}
```

#### ProofRegistry.sol（凭证存证）
```solidity
// 凭证上传与 AI 审核存证
contract ProofRegistry {
    enum ProofStatus { Pending, AIApproved, AIRejected, ManualReview }
    
    struct Proof {
        uint256 campaignId;
        uint256 milestoneId;
        bytes32 proofHash;        // 凭证文件哈希
        bytes32 aiReportHash;     // AI 审核报告哈希
        ProofStatus status;
        uint256 amount;           // 申请提取金额
        string ipfsUri;           // 凭证文件 IPFS 地址
        uint256 timestamp;
    }
    
    mapping(uint256 => Proof[]) public campaignProofs;
    
    // 上传凭证
    function submitProof(
        uint256 campaignId,
        uint256 milestoneId,
        bytes32 proofHash,
        uint256 amount,
        string calldata ipfsUri
    ) external returns (uint256 proofId);
    
    // AI 审核结果上链
    function recordAIReview(
        uint256 campaignId,
        uint256 proofId,
        bytes32 aiReportHash,
        ProofStatus status
    ) external; // 仅限授权的 AI 审核服务调用
    
    // 事件
    event ProofSubmitted(uint256 indexed campaignId, uint256 proofId, bytes32 proofHash);
    event AIReviewRecorded(uint256 indexed campaignId, uint256 proofId, ProofStatus status);
}
```

#### MilestoneVault.sol（更新）
```solidity
// 里程碑管理与资金分阶段释放（含凭证验证）
contract MilestoneVault {
    // 提款需要凭证审核通过
    function withdrawWithProof(
        uint256 campaignId,
        uint256 milestoneId,
        uint256 proofId
    ) external {
        // 验证凭证已通过 AI 审核
        require(
            proofRegistry.getProofStatus(campaignId, proofId) == ProofStatus.AIApproved,
            "Proof not approved"
        );
        // 执行提款...
    }
}
```

### 4.2 关键事件

```solidity
// 捐赠事件
event DonationMade(uint256 indexed campaignId, address indexed donor, uint256 amount, bool isEnterprise);

// 凭证提交
event ProofSubmitted(uint256 indexed campaignId, uint256 proofId, bytes32 proofHash, uint256 amount);

// AI 审核完成
event AIReviewCompleted(uint256 indexed campaignId, uint256 proofId, bool approved, bytes32 reportHash);

// 凭证验证后提款
event WithdrawalWithProof(uint256 indexed campaignId, uint256 milestoneId, uint256 amount, uint256 proofId);

// 企业服务付费
event EnterpriseServicePaid(bytes32 indexed paymentId, address indexed enterprise, bytes32 serviceId, uint256 amount);
```

---

## 五、AI 凭证审核模块

### 5.1 审核流程

```
┌─────────────────────────────────────────────────────────────────┐
│                      AI 凭证审核流程                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. 受益人上传凭证（发票/收据/医疗单据）                         │
│                    ↓                                             │
│  2. 文件存储到 IPFS，哈希上链                                    │
│                    ↓                                             │
│  3. AI 视觉模型分析凭证                                          │
│     ├── OCR 提取：金额、日期、收款方、用途                       │
│     ├── 真实性检测：是否为伪造/PS                                │
│     └── 匹配验证：与里程碑用途是否一致                           │
│                    ↓                                             │
│  4. 生成审核报告                                                 │
│     {                                                            │
│       "status": "approved",                                      │
│       "extracted": { "amount": 500, "date": "2026-01-15" },      │
│       "confidence": 0.95,                                        │
│       "reason": "凭证与里程碑用途匹配"                           │
│     }                                                            │
│                    ↓                                             │
│  5. 审核结果                                                     │
│     ├── 通过 → 审核报告哈希上链 → 触发资金释放                   │
│     └── 不通过 → 返回原因 → 要求补充材料                         │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 AI 审核能力

| 能力 | 说明 | 技术实现 |
|------|------|----------|
| **OCR 提取** | 识别凭证中的金额、日期、收款方 | GPT-4V / Claude Vision |
| **真实性检测** | 检测图片是否被 PS / 伪造 | 图像分析 + 元数据检查 |
| **格式验证** | 是否为有效的发票/收据格式 | 模板匹配 + 规则引擎 |
| **用途匹配** | 凭证内容与里程碑用途是否一致 | 语义匹配 + NLP |
| **金额校验** | 凭证金额与申请提取金额是否一致 | 数值比对 |

### 5.3 AI Tools 设计

```typescript
// 凭证审核 AI Tool
verify_proof: {
  proofId: number;
  campaignId: number;
  milestoneId: number;
  imageUrl: string;        // IPFS URL
  requestedAmount: number;
  milestoneDescription: string;
}

// 返回结构
interface AIReviewResult {
  status: 'approved' | 'rejected' | 'manual_review';
  confidence: number;      // 0-1
  extracted: {
    amount: number;
    date: string;
    recipient: string;
    purpose: string;
  };
  checks: {
    amountMatch: boolean;
    dateValid: boolean;
    formatValid: boolean;
    authenticityScore: number;
    purposeMatch: boolean;
  };
  reason: string;
  reportHash: string;      // 审核报告哈希
}
```

---

## 六、开发模块划分

### 6.1 前端组

| 模块 | 功能 | 优先级 |
|------|------|--------|
| **Landing Page** | 品牌展示、价值主张 | P0 |
| **捐赠者 Dashboard** | 捐赠历史、资金追踪、凭证查看 | P0 |
| **发起人 Dashboard** | 项目管理、凭证上传、提款申请 | P0 |
| **企业 Dashboard** | 品牌定制、高级报告、x402 付费 | P1 |
| **项目详情页** | 双视角展示、里程碑进度 | P0 |
| **凭证上传界面** | 文件上传、预览、AI 审核状态 | P0 |
| **AI Chat** | 自然语言交互 | P1 |

**页面路由**：
```
/                        → Landing Page
/campaigns               → 项目列表
/campaigns/[id]          → 项目详情（双视角）
/dashboard/donor         → 捐赠者仪表盘
/dashboard/beneficiary   → 发起人/受益人仪表盘
/dashboard/enterprise    → 企业仪表盘
/proof/upload            → 凭证上传
/proof/[id]              → 凭证详情与审核状态
/track/[txHash]          → 资金追踪
```

### 6.2 AI 组

| 模块 | 功能 | 优先级 |
|------|------|--------|
| **凭证 OCR** | 提取凭证关键信息 | P0 |
| **真实性检测** | 检测伪造/PS | P0 |
| **用途匹配** | 凭证与里程碑匹配 | P0 |
| **审核报告生成** | 生成结构化报告 | P0 |
| **资金解释** | 自然语言解释资金流向 | P1 |
| **意图解析** | 自然语言 → 操作 | P1 |

### 6.3 合约组

| 模块 | 功能 | 优先级 |
|------|------|--------|
| **CampaignRegistry** | 项目注册、查询 | P0 |
| **ProofRegistry** | 凭证上传、AI 审核存证 | P0 |
| **MilestoneVault** | 里程碑 + 凭证验证提款 | P0 |
| **BatchDonate** | 批量捐赠 | P0 |
| **x402PaymentHub** | 企业付费结算 | P1 |

### 6.4 后端组

| API 路由 | 功能 | 收费 |
|----------|------|------|
| `POST /api/donate` | 捐赠 | 免费 |
| `GET /api/campaigns` | 项目列表 | 免费 |
| `POST /api/proof/upload` | 上传凭证 | 免费 |
| `POST /api/proof/review` | 触发 AI 审核 | 免费 |
| `GET /api/track/[address]` | 资金追踪 | 免费 |
| `GET /api/reports/monthly` | 月度报告 | **x402** |
| `GET /api/reports/annual` | 年度报告 | **x402** |
| `POST /api/export/tax` | 税务凭证 | **x402** |
| `GET /api/analytics/advanced` | 高级分析 | **x402** |

---

## 七、MVP 范围

### 7.1 必做（P0）

1. **双视角基础功能**
   - 捐赠者：捐赠 + 追踪 + 查看凭证
   - 发起人：创建项目 + 上传凭证 + 申请提款

2. **AI 凭证审核**
   - 凭证上传 → AI OCR + 验证 → 审核结果上链
   - 审核通过 → 资金释放

3. **链上核心合约**
   - CampaignRegistry + ProofRegistry + MilestoneVault

4. **资金流可视化**
   - Donation → Campaign → Proof → Withdrawal

### 7.2 可选加分（P1）

1. **x402 企业付费**
   - 企业 Dashboard + 高级报告 API
   - x402 支付流程演示

2. **批量微捐**
   - 一次交易多项目捐赠

3. **AI 高级功能**
   - 资金去向自然语言解释
   - 个性化推荐

---

## 八、Hackathon Demo 流程（3 分钟精简版）

### 8.1 核心策略：3 个"Wow Moment"

> **原则**：不要面面俱到，集中火力打 3 个最能打动评委的点

| 时间 | 场景 | Wow Point | 评委心理 |
|------|------|-----------|----------|
| 0:00-0:20 | 开场 | 问题+方案一句话 | "这个问题确实存在" |
| 0:20-1:20 | **AI 审核** | 上传凭证→AI识别→自动放款 | "这个技术很酷！" |
| 1:20-2:00 | **双视角** | 捐赠者看到凭证+资金流 | "这解决了信任问题" |
| 2:00-2:40 | **x402** | 企业付费一键完成 | "商业模式可行" |
| 2:40-3:00 | 结尾 | 总结+愿景 | "值得投票" |

### 8.2 精简 Demo 脚本

```
┌─────────────────────────────────────────────────────────────────┐
│  【开场】20 秒 - 直击痛点                                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  演讲词：                                                        │
│  "慈善最大的问题是什么？信任。                                   │
│   捐款人不知道钱去哪了，受益人提款无人监督。                     │
│   GiveFlow 用 AI + 区块链解决这个问题——                         │
│   每一笔提款都要凭证，AI 自动审核，链上永久可查。"               │
│                                                                  │
│  【画面】展示 Landing Page，突出 Slogan                          │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  【场景1】60 秒 - AI 凭证审核 ★★★ 最核心创新                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  演讲词：                                                        │
│  "现在我是项目受益人 Alice，我要提取 $500 用于医疗。"            │
│                                                                  │
│  【操作】                                                        │
│  1. 点击"申请提款" → 输入金额 $500                              │
│  2. 上传医疗发票图片 （预先准备好）                              │
│  3. 点击"提交"                                                  │
│                                                                  │
│  【等待 3-5 秒，AI 处理】                                        │
│                                                                  │
│  演讲词：                                                        │
│  "AI 正在分析这张发票..."                                        │
│                                                                  │
│  【展示 AI 审核结果】                                            │
│  ┌────────────────────────────────┐                              │
│  │ ✅ AI 审核通过                 │                              │
│  │ 识别金额：$500 ✓              │                              │
│  │ 识别日期：2026-01-15 ✓        │                              │
│  │ 用途匹配：医疗费用 ✓          │                              │
│  │ 真实性：95% 置信度            │                              │
│  │ [查看链上记录]                │                              │
│  └────────────────────────────────┘                              │
│                                                                  │
│  演讲词：                                                        │
│  "AI 自动识别了金额、日期，判断与申请用途一致，                  │
│   审核报告已上链，资金自动释放！                                 │
│   整个过程无需人工审核，防止造假，完全透明。"                    │
│                                                                  │
│  【点击查看链上记录，展示 Monad 区块浏览器】                     │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  【场景2】40 秒 - 捐赠者视角追踪                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  演讲词：                                                        │
│  "现在切换到捐赠者 Bob 的视角——他捐了 $10，想知道钱去哪了。"    │
│                                                                  │
│  【操作】切换到捐赠者 Dashboard                                  │
│                                                                  │
│  【展示】                                                        │
│  1. 资金流图：$10 → 项目池 → 里程碑1 已释放                     │
│  2. 点击查看凭证：显示 Alice 上传的发票                          │
│  3. AI 解释："您的捐款已用于购买医疗用品"                        │
│                                                                  │
│  演讲词：                                                        │
│  "Bob 可以看到自己的每一分钱去向，                               │
│   看到受益人提交的凭证，看到 AI 审核报告。                       │
│   真正的透明——不是平台告诉你透明，而是你自己能验证。"            │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  【场景3】40 秒 - x402 企业付费                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  演讲词：                                                        │
│  "个人用户完全免费。那平台怎么赚钱？                             │
│   企业用户按需付费——用 x402 协议。"                              │
│                                                                  │
│  【操作】切换到企业 Dashboard                                    │
│  1. 点击"生成 CSR 报告"                                         │
│  2. 弹出支付确认：30 USDC                                        │
│  3. 确认支付 → 钱包签名                                          │
│  4. 报告生成完成 → 展示精美 PDF                                  │
│                                                                  │
│  演讲词：                                                        │
│  "企业按需付费，用多少付多少，链上透明结算。                     │
│   不用订阅，不用预付，Monad 低 Gas 让微支付成为可能。"           │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  【结尾】20 秒 - 总结愿景                                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  演讲词：                                                        │
│  "GiveFlow：                                                     │
│   - AI 审核每一笔提款，防止造假                                  │
│   - 捐赠者可追踪每一分钱，重建信任                               │
│   - 企业付费，个人免费，可持续商业模式                           │
│                                                                  │
│   我们相信，透明是慈善最好的监督。                               │
│   Thank you!"                                                    │
│                                                                  │
│  【画面】回到 Landing Page，展示团队 Logo                        │
└─────────────────────────────────────────────────────────────────┘
```

### 8.3 Demo 准备清单

| 准备项 | 状态 | 备注 |
|--------|------|------|
| **测试账户** | □ | 准备 3 个钱包：受益人、捐赠者、企业 |
| **示例项目** | □ | 预先创建"乡村医疗救助"项目，已有捐款 |
| **测试发票** | □ | 准备 1 张清晰的医疗发票图片（金额 $500） |
| **CSR 报告模板** | □ | 预先设计好精美的 PDF 报告 |
| **录屏备份** | □ | 提前录制完整 Demo，网络出问题时播放 |
| **彩排** | □ | 至少彩排 3 遍，控制在 2:50 以内 |

### 8.4 评委 Q&A 预判

| 可能问题 | 答案要点 |
|----------|----------|
| **AI 审核准确率？** | "目前置信度阈值 90%，低于此会转人工复核；随着数据积累会持续提升" |
| **如果 AI 被骗了？** | "我们有元数据校验、图片伪造检测；高金额自动触发人工复核" |
| **为什么用 Monad？** | "低 Gas 让微捐和 x402 微支付可行；高吞吐支持实时追踪" |
| **商业模式可行吗？** | "企业有真实需求：CSR报告、税务凭证；x402 按需付费降低门槛" |
| **和现有方案对比？** | "传统平台是黑箱；其他 Web3 方案只有链上记录没有凭证审核" |

### 8.5 获胜关键点

```
┌─────────────────────────────────────────────────────────────────┐
│                      🏆 获胜关键                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. 【演示流畅】不要卡顿，提前彩排，准备录屏备份                 │
│                                                                  │
│  2. 【讲故事】不要讲技术细节，讲"问题→方案→效果"               │
│                                                                  │
│  3. 【视觉冲击】AI 审核结果要有动效，资金流图要美观              │
│                                                                  │
│  4. 【时间控制】宁可少讲，不要超时；核心场景要完整               │
│                                                                  │
│  5. 【自信收尾】结尾要有力，"透明是慈善最好的监督"              │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 九、风险与规避

| 风险 | 影响 | 规避方案 |
|------|------|----------|
| **AI 误判凭证** | 错误放行/拒绝 | 置信度阈值 + 人工复核通道 |
| **凭证造假** | 骗取资金 | AI 真实性检测 + 元数据校验 |
| **企业不付费** | 收入不足 | 免费功能足够吸引用户，付费功能有明确价值 |
| **x402 集成复杂** | 开发延期 | 先 Mock 付费流程，后续完善 |
| **隐私泄露** | 凭证敏感信息 | 凭证存 IPFS 加密，链上只存哈希 |

---

## 十、成功标准

### Hackathon 评判维度

| 维度 | GiveFlow V3 对应 | 得分潜力 |
|------|------------------|----------|
| **创新性** | AI 凭证审核 + x402 商业模式 + 双视角 | ⭐⭐⭐⭐⭐ |
| **技术实现** | 合约 + AI + x402 完整闭环 | ⭐⭐⭐⭐⭐ |
| **Monad 特性** | 低 Gas 微支付 + 并行捐赠 | ⭐⭐⭐⭐ |
| **商业可行性** | 个人免费 + 企业付费模式清晰 | ⭐⭐⭐⭐⭐ |
| **社会影响力** | 解决慈善透明 + 防造假问题 | ⭐⭐⭐⭐⭐ |

### 核心交付物

- [ ] 双视角 Dashboard（捐赠者 + 发起人）
- [ ] AI 凭证审核功能（上传 → OCR → 验证 → 上链）
- [ ] 凭证验证后提款流程
- [ ] 资金流可视化
- [ ] x402 企业付费演示（可 Mock）
- [ ] 3 分钟 Demo 视频

---

## 附录：快速启动

```bash
# 前端
npx create-next-app@latest giveflow --typescript --tailwind --app
cd giveflow
npx shadcn@latest init
npm install wagmi viem @tanstack/react-query ai openai

# 合约
cd contracts
forge init
forge install OpenZeppelin/openzeppelin-contracts

# 部署
forge script script/Deploy.s.sol --rpc-url $MONAD_RPC --broadcast
```

---

## 附录：x402 中间件示例

```typescript
// middleware/x402.ts
import { NextRequest, NextResponse } from 'next/server';

export async function x402Middleware(
  req: NextRequest,
  serviceId: string,
  price: number
) {
  const paymentHeader = req.headers.get('X-Payment-Id');
  
  if (!paymentHeader) {
    // 返回 402 要求支付
    return NextResponse.json({
      error: 'Payment Required',
      payment: {
        serviceId,
        price: `${price} USDC`,
        network: 'monad',
        recipient: process.env.PAYMENT_ADDRESS,
        contract: process.env.X402_CONTRACT
      }
    }, { status: 402 });
  }
  
  // 验证支付
  const isValid = await verifyPayment(paymentHeader);
  if (!isValid) {
    return NextResponse.json({ error: 'Invalid payment' }, { status: 402 });
  }
  
  return null; // 继续处理请求
}
```